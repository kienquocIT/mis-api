# Generated by Django A.B on 2023-11-08 16:33
import random

from django.db import migrations


def gen_sub_domain(apps, schema_editor):
    company_cls = apps.get_model('company', 'company')
    for obj in company_cls.objects.all():
        if company_cls.objects.filter(code=obj.code, tenant=obj.tenant).exists():
            obj.code += str(random.randint(0, 1000))

        obj.sub_domain = f'{obj.code}.{obj.tenant.code}'.lower()
        obj.save(update_fields=['sub_domain', 'code'])


class Migration(migrations.Migration):

    dependencies = [
        ('company', '0009_company_sub_domain_alter_company_unique_together'),
    ]

    operations = [
        # omit reverse_code=... if you don't want the migration to be reversible.
        migrations.RunPython(gen_sub_domain, reverse_code=migrations.RunPython.noop),
    ]
